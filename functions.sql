       .
       /* Functions: A built in Sql code which accepts an input value,
processes it and returns an output value

1.single row functions: take and gives only one value. Example: 'MARIA'--->lOWER()--->'maria'
2.Multi row functions: took multiple input row values and produce an o/p. Eg: SUM()-->multiple values(1020,20,40,50)--->1130(o/p) 

Nested Functions: 'Maria'-->Left(2)-->'Ma'--->Lower()--->'ma'

len(lower(left('Maria',2)))
          <------1------>
    <------------2--------->
<----------------3----------->

Note: Always starts with inner Function
*/
use MyDatabase;
/*String Functions:
1.Concat:combines multiple strings into one,Lower,Upper*/
select first_name,country,concat(first_name,' ',country) as name_country,
lower(first_name) as Lower_firstname,upper(first_name) as upper_firstname
from customers;

--Trim:Removes leading and Trailing spaces
select first_name,len(first_name) as len_name,len(Trim(first_name)) as len_trim_name from customers
--where first_name!=Trim(first_name)----checks whether we have spaces in name or not

-- Replace: Replaces the specific charcter with a new charcter
select '123-456-789' as phone,
REPLACE('123-456-789','-','') as clean_phone
--syntax: replace('charcter itself','old value(what to rplace)','new value')

--len:counts the how many charcters
select first_name,len(first_name) as length
from customers; 

--Left:Extracts the specific number of characters from the start
--Reteieve the first two charcters of first name
select first_name,left(trim(first_name),2) as first_2_characters from customers;

--Left:Extracts the specific number of characters from the end
--Reteieve the last two charcters of first name
select first_name,right(first_name,2) as first_2_characters from customers;

--substring:Extract the part of the string at a specified position.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
--Retrieve a list of customers first names after removing the first character
select first_name ,substring(Trim(first_name),2,len(first_name)) from customers;

--Number Functions :1.Round 2.Abs
select 3.516,-1.2, round(3.516,2) as round_2,round(3.516,1) as round_1,round(3.516,0) as round_0,Abs(-10);

--Date and time functions:
/* Date---2025-06-02(year-month-date) Time---18:55:45(hours-min-sec) we call both as TIMESTAMP (used in oracle,postgres,Mysql)
DATETIME(in sql server) */
use SalesDB;
select orderid,orderdate,shipdate,creationtime from sales.orders;

--static date: which can be used in all rows
select orderid,creationtime,'2025-08-20' Hardcodeddate from sales.orders;

--GETDATE():Returns the current date and time atthe moment when the query is executed.
select orderid,creationtime,'2025-08-20' Hardcodeddate,GETDATE() Today from sales.orders;

/* Date and Time functions: 
1. Part Extraction--- DAY,MONTH,YEAR,DATEPART,DATENAME,DATETRUNC,EOMONTH
2. Format and casting -- FORMAT,CONVERT,CAST
3. Calculatioons-- DATEADD,DATEDIFF
4. Validation--ISDATE   */

--DAY()-return day from a date,MONTH()-returns month from the date,YEAR()-returns the year from the date.
select orderid,creationtime,year(creationtime) as year_time,MONTH(creationtime) as month,DAY(creationtime) day from Sales.Orders;

--DATEPART()-returns the specific part of a date as a number
select orderid,creationtime,
DATEPART(year,creationtime) year_dp,
DATEPART(month,creationtime) mm_dp,
DATEPART(day,creationtime) day_dp,
DATEPART(hour,creationtime) hour_dp,
DATEPART(QUARTER,creationtime) quarter_dp,
DATEPART(WEEK,creationtime) week_dp
from Sales.Orders;

--DATENAME(): returns the name of a specifice part of the date
select orderid,creationtime,
DATENAME(MONTH,creationtime) month_dn,
DATENAME(WEEKDAY,creationtime) weekday_dn,
DATENAME(DAY,creationtime) day_dn from Sales.Orders;

--DATETRUNC()-Truncates the date from the specific part
select orderid,creationtime,
DATETRUNC(minute,creationtime) minute_dt, -- Trunc(minute) means after minutes it willbe reset to zero
DATETRUNC(hour,creationtime) hour_dt,
DATETRUNC(day,creationtime) day_dt,
DATETRUNC(month,creationtime) month_dt,
DATETRUNC(year,creationtime) year_dt
from Sales.Orders;

--EOMONTH(): returns the last day of the month
select orderid,creationtime,EOMONTH(creationtime) endofmonth,CAST(DATETRUNC(month,creationtime) as date) 
startofmonth from Sales.Orders;

--How many orders were placed each year
select COUNT(*),YEAR(orderdate)
from Sales.Orders
group by YEAR(OrderDate);

--How many orders were placed each month;
select COUNT(*) as count ,DATENAME(month,OrderDate)
from Sales.Orders
group by DATENAME(month,OrderDate)

--show all the orders that were placed during the february
select * from  Sales.Orders
where DATEPART(month,OrderDate)=02;

/* Date and time functions and returns the data type
1.DAY(),MONTH(),YEAR(),DATEPART()---->returns Integer(INT)
2.DATENAME()--->returns string
3.DATEPART()--->returns DATETIME
4.EOMONTH()--->returns DATE*/

--Formatting-changing the format of a value from one to another 
--casting-changing the datatype to one to other

/* Format()--formats a date or time value.
syntax: FORMAT(value,format [,culture])*/
select orderid,creationtime,FORMAT(creationtime,'dd') dd from Sales.Orders;
select orderid,creationtime,FORMAT(creationtime,'ddd') ddd from Sales.Orders;
select orderid,creationtime,FORMAT(creationtime,'dddd') dddd from Sales.Orders;
select orderid,creationtime,FORMAT(creationtime,'MM') MM from Sales.Orders;
select orderid,creationtime,FORMAT(creationtime,'MMM') MM from Sales.Orders;
select orderid,creationtime,FORMAT(creationtime,'MMMM') MMMM from Sales.Orders;
select orderid,creationtime,FORMAT(creationtime,'dd/MM/yyyy') ddmmyyyy from Sales.Orders;

--TASK-show the creation time in following format
--Day Wed Jan Q1 2025 12:34:56 PM
select orderid,creationtime,
'Day ' + FORMAT(creationtime,'ddd')  + ' ' + Format(creationtime,'MMM')+ ' ' + 'Q' + DATENAME(quarter,creationtime) + ' ' + FORMAT(creationtime,'yyyy')
+ ' ' + FORMAT(creationtime,'HH:mm:ss tt') customformat
from Sales.Orders;

--Number of orders placed 
select FORMAT(orderdate,'MMM yy') orderdate,
COUNT(*)
from Sales.Orders
group by FORMAT(orderdate,'MMM yy');

--CONVERT() -converts date or time value to a different data type
--syntax: convert(data_type,value[,style])
select creationtime,CONVERT(int,'123') as [string to int convert],
CONVERT(Date,'2025-08-20') as [string to date convert],
CONVERT(date,creationtime) dateconversion,
convert(varchar,creationtime,32) as [usa std.style:32] from Sales.Orders;

-- cast():converts a value to datatype
--syntax: cast(value as data_type)
select CAST('123' as int) as [string to int],
CAST(creationtime AS date) as [datetime to date] from Sales.orders;

--DateADD(): Add or subract from a specific time interval to/from a date
--syntax: DATEADD(part,interval,date)
select orderid,orderdate,DATEADD(year,2,OrderDate) as twoyearslater,
DATEADD(month,3,OrderDate) as threemonthslater,
DATEADD(day,-10,OrderDate) as tendaysbefore
from Sales.Orders;

--Datediff(): differences between two dates
--syntax: datediff(part,start_date,end_date)
select orderid,orderdate,shipdate,DATEDIFF(day,orderdate,shipdate) daydiff from Sales.Orders;

use SalesDB;
select employeeid,birthdate,FORMAT(GETDATE(),'yyyy-MM-dd') as todaydate,
DATEDIFF(year,BirthDate,GETDATE()) as age from Sales.employees;

--Task-Find the average shipping duration in days for each month
select month(orderdate) as month,Avg(DATEDIFF(day,OrderDate,ShipDate)) as shippingduration 
from Sales.Orders
group by month(orderdate);

--Find the number of days between each order and previous order
--As we dont know the previous order data table so by using lag() we can access the previous order
--lag(): Access a value from the previous row 
select orderdate currentorderdate,
lag(orderdate) over (order by orderdate) previousorderdate,--- so it will give previous order date  and over order by will do the sort
datediff(day,lag(orderdate) over (order by orderdate),orderdate) noofdays
from Sales.Orders;

--Datevalidation: ISDATE()--check if the value is date ---returns 1 if the string value is date
select ISDATE('123') as checkdate1,
isdate('2025-08-20') as checkdate2,--the date is in standard format by default sql server return 1
isdate('20-08-2025') as checkdate3,-- he date is not in standard format its a differnt format so sql follow the default one return '0'
isdate('2025') as checkdate4,
isdate('20') as checkdate5;

--case when condition
select 
     CAST(orderdate AS date) orderdate
From
(
  select '2025-08-20 ' as orderdate union  -- standard date format 1st 3 but the last one is not in a date format so it sql throw error
  select '2025-08-21' union
  select '2025-08-23' union
  select '2025-08'
)t

---In order to throw this error first check all are dates or not
select 
   orderdate,ISDATE(orderdate) as dateornot
From
(
  select '2025-08-20 ' as orderdate union 
  select '2025-08-21' union
  select '2025-08-23' union
  select '2025-08'
)t

--- then if its not date then display null and do the remaining for cast
select 
   orderdate,ISDATE(orderdate) as dateornot,
   case when isdate(orderdate)=1 then cast(orderdate as date)
       else '9999-01-01'---if its not 1 then it display
   end neworderdate
From
(
  select '2025-08-20 ' as orderdate union 
  select '2025-08-21' union
  select '2025-08-23' union
  select '2025-08'
)t

/* Null Functions: Null means nothing 
 ISNULL() and COALESCE(): If you want replace NULL with some value 
 NULLIF(): replace the value with null
 IS NULL: check if the value is null if its null it returns 'True'
 IS NOT NULL : check if the value is not null then it returns 'False'*/

/*ISNULL(): ISNULL(value,replacement_value)
ISNULL(shippingaddress,'unknown')-- replaces with 'unknown' value
ISNULL(shippingaddress,billingaddress)-- it replaces with billing address values when the shipping value is null*/

/* Coalesce()- Returns the first non-null value from the list
Syntax: coalesce(value1,value2,value3..)*/

--task- Find the average scores of the customers
use SalesDB;
select customerId,score,
coalesce(score,0) score2,
Avg(score) over() avgscores,
avg(coalesce(score,0)) over() Avgscore2
from sales.customers;

--task-Display the full name of customers in a single field by merging their first and last name
-- and add 10 bonus points to each customers score 
select CustomerID,FirstName,LastName,score,
Coalesce(LastName,'') lastname2,
concat(FirstName,Coalesce(LastName,'')) FullName,
coalesce(score,0)+10 as sum
from  sales.customers;

--Sort the customers from lowest to highest scores with nulls apperaing last
select customerid,score
from Sales.Customers 
order by case when Score IS null then 1 else 0 end,score;

/*NullIf-compares the two expressions returns:
--NUll,if they are equal.
--First Value,if they are not equal
Syntax: NULLIF(value1,value2(checking value))*/

--USecase for Nullif Task: Find the sales price for each orders by dividing the sales by quantity.
Select OrderId,Sales,quantity,Sales/Nullif(Quantity,0) as price
from Sales.Orders;

--IS NULL: check if the value is null if its null it returns 'True'  ----Syntax: value is null
--IS NOT NULL : check if the value is not null then it returns 'False'   ----Syntax: value is not  null

--Task: Identify the customers who have no scores
select *
from Sales.Customers
where Score is null;

--Task: Identify the customers who have  scores
select *
from Sales.Customers
where Score is not null;

--Task: listall the details for customers who have not placed any orders
select C.*,O.orderid
from Sales.Customers c
left join Sales.Orders o
on c.CustomerID=o.CustomerID
where o.customerID is  null;

/* CASE STATEMENT:





























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































-+














 